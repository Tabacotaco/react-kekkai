!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=29)}([function(e,t){e.exports=require("react")},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}e.exports=n},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){var r=n(14),o=n(2);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?o(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(21);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t,n){var r=n(1);e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){r(e,t,n[t])})}return e}},function(e,t,n){e.exports=n(19)},function(e,t){function n(e,t,n,r,o,i,a){try{var l=e[i](a),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(r,o)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise(function(o,i){var a=e.apply(t,r);function l(e){n(a,o,i,l,s,"next",e)}function s(e){n(a,o,i,l,s,"throw",e)}l(void 0)})}}},function(e,t,n){var r=n(16),o=n(17),i=n(18);e.exports=function(e){return r(e)||o(e)||i()}},function(e,t){e.exports=function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},function(e,t){e.exports=require("moment")},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t,n){var r=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,i=o&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(20),o)r.regeneratorRuntime=i;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n,r=Object.prototype,o=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",l=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag",c="object"==typeof e,u=t.regeneratorRuntime;if(u)c&&(e.exports=u);else{(u=t.regeneratorRuntime=c?e.exports:{}).wrap=b;var d="suspendedStart",f="suspendedYield",p="executing",h="completed",v={},g={};g[a]=function(){return this};var m=Object.getPrototypeOf,y=m&&m(m(M([])));y&&y!==r&&o.call(y,a)&&(g=y);var k=S.prototype=w.prototype=Object.create(g);C.prototype=k.constructor=S,S.constructor=C,S[s]=C.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===C||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(k),e},u.awrap=function(e){return{__await:e}},O(N.prototype),N.prototype[l]=function(){return this},u.AsyncIterator=N,u.async=function(e,t,n,r){var o=new N(b(e,t,n,r));return u.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},O(k),k[s]="Generator",k[a]=function(){return this},k.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},u.values=M,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,o){return l.type="throw",l.arg=e,t.next=r,o&&(t.method="next",t.arg=n),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],l=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;R(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:M(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),v}}}function b(e,t,n,r){var o=t&&t.prototype instanceof w?t:w,i=Object.create(o.prototype),a=new T(r||[]);return i._invoke=function(e,t,n){var r=d;return function(o,i){if(r===p)throw new Error("Generator is already running");if(r===h){if("throw"===o)throw i;return P()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var l=x(a,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var s=E(e,t,n);if("normal"===s.type){if(r=n.done?h:f,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r=h,n.method="throw",n.arg=s.arg)}}}(e,n,a),i}function E(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function w(){}function C(){}function S(){}function O(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function N(e){var t;this._invoke=function(n,r){function i(){return new Promise(function(t,i){!function t(n,r,i,a){var l=E(e[n],e,r);if("throw"!==l.type){var s=l.arg,c=s.value;return c&&"object"==typeof c&&o.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,i,a)},function(e){t("throw",e,i,a)}):Promise.resolve(c).then(function(e){s.value=e,i(s)},function(e){return t("throw",e,i,a)})}a(l.arg)}(n,r,t,i)})}return t=t?t.then(i,i):i()}}function x(e,t){var r=e.iterator[t.method];if(r===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,x(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=E(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,v;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,v):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function M(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(o.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=n,t.done=!0,t};return i.next=i}}return{next:P}}function P(){return{value:n,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(3),o=n.n(r),i=n(12),a=n.n(i),l=n(9),s=n.n(l),c=n(10),u=n.n(c),d=n(11),f=n.n(d),p=n(4),h=n.n(p),v=n(5),g=n.n(v),m=n(6),y=n.n(m),k=n(7),b=n.n(k),E=n(2),w=n.n(E),C=n(8),S=n.n(C),O=n(1),N=n.n(O),x=n(0),L=n.n(x),R=n(14),T=n.n(R),M=n(15),P=n.n(M),D=120;function $(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]="-",e[13]="-",e[18]="-",e[23]="-",e.join("")}function A(e){return(Array.isArray(e)?e:[e]).filter(function(e){return e})}function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e&&null!==e)switch(T()(e)){case"boolean":return!1;case"number":return isNaN(e)&&0!==e;case"string":return 0===e.trim().length;default:if(P.a.isDate(e))return!P()(e).isValid()}return!0}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.def,n=void 0===t?null:t,r=e.sm,o=void 0===r?null:r,i=e.md,a=void 0===i?null:i,l=e.lg,s=void 0===l?null:l,c=e.xl,u={sm:o,md:a,lg:s,xl:void 0===c?null:c},d=["col",null===n?"col-12":!1===n||"number"!=typeof n||isNaN(n)?"col-none":"col-".concat(n)];return Object.keys(u).filter(function(e){return null!==u[e]&&(!1===u[e]||"number"==typeof u[e]&&!isNaN(u[e]))}).forEach(function(e){return d.push(!1===u[e]?"col-".concat(e,"-none"):"col-".concat(e,"-").concat(u[e]))}),d.join(" ")}function F(e,t){var n=Symbol("TRANS");return e[n]=e[t],delete e[t],n}function z(e,t){return t||e.$fieldOpts.filter(function(e){var t=e.type;return ne===t}).map(function(e){var t=e.key,n=e.props,r=n.name,o=void 0===r?t:r,i=n.label,a=n.card,l=void 0===a?{def:12}:a,s=n.sortable,c=void 0!==s&&s;return{name:o,label:i,width:I(l),sortable:c}})}function j(e,t){var n=e.$dataviewOpts.props.reorderable,r=void 0!==n&&n;return t||e.$fieldOpts.filter(function(e){var t=e.type;return ne===t}).sort(function(e,t){var n=e.locked,r=void 0!==n&&n,o=t.locked;return r===(void 0!==o&&o)?0:!0===r?-1:1}).map(function(e,t){var n=e.key,o=e.props,i=o.name,a=void 0===i?n:i,l=o.label,s=o.list,c=void 0===s?D:s,u=o.filter,d=void 0===u?null:u,f=o.locked,p=void 0!==f&&f,h=o.hidden,v=void 0!==h&&h,g=o.resizable,m=void 0!==g&&g,y=o.lockable,k=void 0!==y&&y,b=o.hideable,E=void 0===b||b,w=o.sortable,C=void 0!==w&&w;return{name:a,label:l,width:c,locked:p,seq:t,hidden:v,filterUID:null===d?null:$(),filter:d,resizable:m,lockable:k,reorderable:r,hideable:E&&"string"==typeof l,sortable:C}})}function G(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;t.classList[e?"add":"remove"]("active"),n.classList[e?"add":"remove"]("active")}function B(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;arguments.length>3&&arguments[3];t.classList[e?"add":"remove"]("hover"),n.classList[e?"add":"remove"]("hover")}var q={List:$(),Form:$(),Card:$()},U={bdColor:"#d6d8db",bgColor:"#e2e3e5",txColor:"#383d41"},H=(n(22),{defaultClassName:Symbol("DEFAULT_CLASS_NAME"),listClassName:Symbol("CELL_CLASS_NAME"),groupClassName:Symbol("GROUP_CLASS_NAME"),getGridClassName:Symbol("GRID_CLASS_NAME"),gridLabelCSS:Symbol("GRID_LABEL_CSS"),validCells:Symbol("VALID_CELLS"),getCell:Symbol("GET_CELL"),isDisplay:Symbol("IS_DISPLAY"),onHover:Symbol("ON_HOVER")});function W(e){return L.a.createElement("div",{className:"kekkai-display"},e.children)}function V(e){var t=e.dataModel,n=e.name,r=e.children,i=void 0===r?[]:r,a=e.onChange,l=void 0===a?function(){}:a;return L.a.createElement("div",{className:"kekkai-editor"},A(i).map(function(e){return L.a.createElement(e.type,o()({key:"editor"},s()({},e.props,{value:t[n],onChange:function(e){t[n]=e.target.value,l(n,t[n],t)}})))}))}var K=H.defaultClassName,J=H.listClassName,Y=H.groupClassName,X=H.validCells,Z=H.isDisplay,Q=H.getCell,ee=H.getGridClassName,te=H.onHover,ne=function(e){function t(){var e,n;h()(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=y()(this,(e=b()(t)).call.apply(e,[this].concat(o))),N()(w()(n),te,function(){var e=n.props,t=e.name,r=e.dataModel.$getValid(t);n.$container&&!0!==r&&n.$container.setAlert(r,{type:"warning",icon:"fa fa-exclamation-triangle"})}),n}return S()(t,e),g()(t,[{key:Q,value:function(e,t){var n=e.filter(function(e){return e.type===t});return 0===n.length?null:n}},{key:ee,value:function(e){var t=this.props[e];return[].concat(a()(this[H.defaultClassName]),[I(t)]).join(" ")}},{key:"render",value:function(){var e=this[H.validCells],t=this[H.getCell](e,W),n=this[H.getCell](e,V),r=this.props,i=r.label,a=r.name,l=r.dataModel;switch(this.$dataview.panel){case q.List:return L.a.createElement("td",{className:this[H.listClassName],onMouseOver:this[H.onHover]},this[H.isDisplay]?t.map(function(e){return L.a.createElement(e.type,o()({key:"display"},e.props))}):n.map(function(e){return L.a.createElement(e.type,o()({key:"editor"},e.props,{dataModel:l,name:a}))}));default:return L.a.createElement("div",{className:this[H.getGridClassName]("form")},L.a.createElement("div",{className:this[H.groupClassName],onMouseOver:this[H.onHover]},L.a.createElement("label",null,i),this[H.isDisplay]?t.map(function(e){return L.a.createElement(e.type,o()({key:"display"},e.props))}):n.map(function(e){return L.a.createElement(e.type,o()({key:"editor"},e.props,{dataModel:l,name:a}))})))}}},{key:"$owner",get:function(){return this.props.owner}},{key:"$container",get:function(){return this.props.container}},{key:"$dataview",get:function(){return this.props.dataview}},{key:K,get:function(){var e=this.props,t=e.name,n=e.dataModel,r=e.overflow,o=void 0===r||r,i=e.align,a=void 0===i?"left":i,l=n.$getValid(t);return["kekkai-field","text-".concat(a),!1===o&&q.List!==this.$dataview.panel?"":"text-overflow",!0===l?"":"invalid"].filter(function(e){return"string"==typeof e&&e.trim().length>0})}},{key:J,get:function(){return a()(this[H.defaultClassName]).join(" ")}},{key:Y,get:function(){var e=this.$dataview.labelSize,t=["form-group"];return q.Form===this.$dataview.panel&&"number"==typeof e&&!isNaN(e)&&e>0&&e<13&&(t.push("horizontal"),t.push("horizontal-".concat(e))),t.join(" ")}},{key:X,get:function(){var e=this.props,t=e.name,n=e.dataModel,r=e.children,o=A(void 0===r?[]:r).filter(function(e){return null!==e&&[W,V].indexOf(e.type)>=0});return o.findIndex(function(e){return e.type===W})<0&&o.push(L.a.createElement(W,null,n[t])),o}},{key:Z,get:function(){var e=this.props,t=e.name,n=e.dataModel,r=this[H.getCell](this[H.validCells],V);return!n.$editable||null===r||r.filter(function(e){var r=e.props.editable,o=void 0===r?function(){return!0}:r;return o instanceof Function?o(n[t],n):!0===o}).length!==r.length}}],[{key:"isEditable",value:function(e){var t,n,r=e.props,o=r.name,i=r.dataModel,a=r.children,l=A(void 0===a?[]:a).filter(function(e){return null!==e&&V===e.type});return 0!==l.length&&!0===(t=l[0].props.editable,(n=void 0===t?function(){return!0}:t)instanceof Function?n(i[o],i):!0===n)}},{key:"isValid",value:function(e){var t,n,r,o,i,a=e.props,l=a.name,s=a.dataModel,c=a.children,u=A(void 0===c?[]:c).filter(function(e){return null!==e&&V===e.type});return 0===u.length||!0===(t=u[0].props,n=t.required,r=void 0!==n&&n,o=t.validation,i=void 0===o?function(){return!0}:o,(!r||!_(s[l]))&&i(l,s[l],s))}},{key:"getSortable",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).sortable,t=void 0!==e&&e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.seq,o=n.dir,i=void 0===o?"asc":o,a="boolean"==typeof t?{}:t,l=a.seq,s=a.dir;return"boolean"==typeof t?t:{seq:"number"!=typeof l||isNaN(l)&&0!==l?r:l,dir:"string"==typeof s&&["asc","desc"].indexOf(s.toLowerCase())?s.toLowerCase():i}}}]),t}(x.Component),re=n(13),oe=n.n(re);function ie(e){var t=e.icon,n=e.disabled,r=void 0!==n&&n,o=e.children,i=void 0===o?[]:o,a=e.onClick,l=void 0===a?function(){}:a;return L.a.createElement("a",{className:"kekkai-nav-btn",disabled:r,onClick:r?null:l},"string"!=typeof t?null:L.a.createElement("i",{className:t}),A(i))}function ae(e){var t=e.className,n=e.children;return L.a.createElement("li",{className:t},L.a.createElement("a",null,n))}function le(e){return L.a.createElement("li",null,L.a.createElement(ie,e))}function se(e){return L.a.createElement("li",null,L.a.createElement("input",e))}function ce(e){var t=e.color;return L.a.createElement("li",{className:"divider",style:{backgroundColor:t}})}function ue(e){var t=e.className,n=void 0===t?"":t,r=e.align,o=void 0===r?"left":r,i=e.children,a=void 0===i?[]:i;return L.a.createElement("ul",{className:["nav",n,"left"!==o?o:""].join(" ")},A(a).filter(function(e){var t=e.type;return[le,se,ae,de].indexOf(t)>=0}))}var de=function(e){function t(){var e,n;h()(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=y()(this,(e=b()(t)).call.apply(e,[this].concat(o))),N()(w()(n),"state",{show:!1}),N()(w()(n),"onTrigger",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};n.setState({show:!0==!n.state.show},function(){var t=n.props,r=t.onOpen,o=void 0===r?function(){}:r,i=t.onClose,a=void 0===i?function(){}:i,l=n.state.show;void 0!==l&&l?o():a(),e()})}),N()(w()(n),"onClickOutside",function(e){var t=n.state.show,r=n.refs.menu;t&&!r.contains(e.target)&&(e.preventDefault(),e.stopPropagation(),n.onTrigger())}),n}return S()(t,e),g()(t,[{key:"componentDidMount",value:function(){t.Body.addEventListener("click",this.onClickOutside)}},{key:"componentWillUnmount",value:function(){t.Body.removeEventListener("click",this.onClickOutside)}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.tag,i=void 0===r?"div":r,a=n.display,l=n.bgColor,c=n.bdColor,u=void 0===c?"none":c,d=n.txColor,f=n.children,p=void 0===f?[]:f,h=this.state.show;return L.a.createElement(i,(e={},N()(e,"data-tag",i),N()(e,"className","kekkai-dropdown"),N()(e,"ref","dropdown"),e),[L.a.createElement(ie,{key:"displayBtn",onClick:function(){return t.onTrigger()}},a),L.a.createElement("ul",{key:"menu",ref:"menu",className:"menu",style:s()({display:h?"block":"none",backgroundColor:l,color:d},"none"===u?{}:{border:"1px solid ".concat(u)},this.positionCSS)},A(p).filter(function(e){var t=e.type;return[le,ce].indexOf(t)>=0}).map(function(e){return ce===e.type?e:L.a.createElement(le,o()({key:e.key},e.props,{onClick:function(){return t.onTrigger(e.props.onClick)}}))}))])}},{key:"positionCSS",get:function(){var e=this.props,n=e.tag,r=void 0===n?"div":n,o=e.align,i=void 0===o?"left":o;if("div"!==r)return{position:"absolute"};var a="dropdown"in this.refs?this.refs.dropdown.getBoundingClientRect():{},l=a.width,s=void 0===l?0:l,c=a.height,u=void 0===c?0:c,d=a.top,f=void 0===d?0:d,p=a.left,h=void 0===p?0:p,v=(a.right,t.Body.clientWidth);return"left"===i?{top:f+u,left:h,right:"auto"}:{top:f+u,left:"auto",right:v-h-s}}}]),t}(x.Component);N()(de,"Body",document.body);var fe=function(e){function t(){return h()(this,t),y()(this,b()(t).apply(this,arguments))}return S()(t,e),g()(t,[{key:"render",value:function(){var e=this.props,t=e.className,n=void 0===t?"":t,r=e.children,o=void 0===r?[]:r,i=e.style,a=void 0===i?{}:i;return L.a.createElement("nav",{className:["kekkai-navbar",n].join(" "),style:a},A(o).filter(function(e){return ue===e.type}))}}]),t}(x.Component),pe={tgToolbar:Symbol("TG_TOOLBAR"),tgSelection:Symbol("TG_SELECTION"),tgRowMenu:Symbol("TG_ROW_MENU"),tgRowDbclick:Symbol("TG_ROW_DBCLICK"),emNone:Symbol("EM_NONE"),emInline:Symbol("EM_INLINE"),emPopup:Symbol("EM_POPUP"),ref:Symbol("REF"),uuid:Symbol("UUID"),container:Symbol("CONTAINER"),showMessage:Symbol("SHOW_MESSAGE"),options:Symbol("OPTIONS"),todos:Symbol("TODOS"),getTargetData:Symbol("GET_TARGET_DATA")},he=function(){function e(){h()(this,e)}return g()(e,[{key:"TOOLBAR",get:function(){return pe.tgToolbar}},{key:"SELECTION",get:function(){return pe.tgSelection}},{key:"ROW_MENU",get:function(){return pe.tgRowMenu}},{key:"ROW_DBCLICK",get:function(){return pe.tgRowDbclick}}]),e}(),ve=function(){function e(){h()(this,e)}return g()(e,[{key:"NONE",get:function(){return pe.emNone}},{key:"INLINE",get:function(){return pe.emInline}},{key:"POPUP",get:function(){return pe.emPopup}}]),e}(),ge=new he,me=new ve,ye=pe.uuid,ke=pe.ref,be=pe.container,Ee=pe.options,we=pe.showMessage,Ce=function(){function e(t){var n=t.ref,r=t.concat,o=t.text,i=t.icon,a=t.trigger,l=void 0===a?ge.TOOLBAR:a,s=t.editingMode,c=void 0===s?me.NONE:s,u=t.executable,d=void 0===u?function(){return!0}:u,f=t.execute,p=void 0===f?function(){}:f,v=t.onSuccess,g=void 0===v?function(){}:v,m=t.confirmMsg,y=void 0===m?{type:"",icon:"",title:"",content:""}:m,k=t.responseMsg,b=void 0===k?{type:"",icon:"",title:"",content:""}:k;if(h()(this,e),N()(this,ye,$()),N()(this,ke,null),N()(this,be,null),N()(this,Ee,{}),"string"!=typeof n||0===n.trim().length)throw new Error("KekkaiTodo'ref is required.");this[pe.ref]=n,this[pe.options]={concat:r,text:o,icon:i,trigger:l,editingMode:c,executable:d,confirmMsg:y,execute:p,onSuccess:g,responseMsg:b}}return g()(e,[{key:"isExecutable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=void 0===t?null:t,r=e.list,o=void 0===r?[]:r,i=this[pe.container];return!0===(0,this[pe.options].executable)({data:n,list:o},i)}},{key:"execute",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.data,n=void 0===t?null:t,r=e.list,o=void 0===r?[]:r,i=this[pe.container],a=this[pe.options].execute,l=this[pe.showMessage]("confirmMsg"),s=l.show,c=l.type,u=l.icon,d=l.title,f=l.content;this.isExecutable({data:n,list:o})&&(s?i.setConfirm(f,{type:c,icon:u,title:d,callbackFn:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?a({data:n,list:o},i):(i.data.forEach(function(e){return e.$undo(!1)}),i.forceUpdate())}}):a({data:n,list:o},i))}},{key:"onResponse",value:function(e){var t=e.success,n=void 0!==t&&t,r=e.msg,o=void 0===r?"":r,i=this[pe.container];try{var a=this[pe.options].onSuccess,l=void 0===a?function(){}:a,s=this[pe.showMessage]("responseMsg"),c=s.show,u=s.type,d=s.icon,f=s.title,p=s.content;if(!n)throw new Error(o);i.setState({executing:{todo:null,data:null},alert:{show:c,type:u,icon:d,title:f,content:p}},function(){l({success:n,msg:o},i)})}catch(e){console.error(e),i.setAlert("系統發生預期外之錯誤.",{type:"danger",icon:"fa fa-exclamation-circle",title:"System Error"})}}},{key:we,value:function(e){var t=this[pe.options][e],n=t.type,r=void 0===n?"":n,o=t.icon,i=void 0===o?"":o,a=t.title,l=void 0===a?"":a,s=t.content,c=void 0===s?"":s;return{show:"string"==typeof c&&c.trim().length>0,type:r,icon:i,title:l,content:c}}},{key:"container",set:function(e){this[pe.container]=e}},{key:"uuid",get:function(){return this[pe.uuid]}},{key:"ref",get:function(){return this[pe.ref]}},{key:"concat",get:function(){return this[pe.options].concat||null}},{key:"text",get:function(){return this[pe.options].text}},{key:"icon",get:function(){return this[pe.options].icon}},{key:"trigger",get:function(){return this[pe.options].trigger}},{key:"editingMode",get:function(){return this[pe.options].editingMode}}]),e}(),Se=pe.container,Oe=pe.todos,Ne=pe.getTargetData,xe=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(h()(this,e),N()(this,Se,null),N()(this,Oe,[]),n.filter(function(e){return ge.ROW_DBCLICK===e.trigger}).length>1)throw new Error("Only could set 1 Trigger(ROW_DBCLICK).");this[pe.container]=t,this[pe.todos]=n.map(function(e){return e.container=t,e})}return g()(e,[{key:"getAllowedTodos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.strict,r=void 0===n||n,o=t.targetData,i=void 0===o?null:o,a=this[pe.container],l=a.selecteds.length>0,s=a.editings.length>0,c=this[pe.getTargetData](e,{strict:r,targetData:i}),u=c.data,d=c.list;switch(a.panel){case q.Form:return ge.TOOLBAR!==e?[]:this.todos.filter(function(e){return!s&&!0===e.isExecutable([ge.TOOLBAR,ge.SELECTION].indexOf(e.trigger)>=0?{data:null,list:d}:{data:u,list:[]})});case q.List:return this.todos.filter(function(t){return e===t.trigger}).filter(function(e){switch(e.trigger){case ge.TOOLBAR:return!l&&!0===e.isExecutable({data:u,list:d});case ge.SELECTION:return(!r||l)&&!0===e.isExecutable({data:u,list:d});default:return!l&&!s&&(r?!0===e.isExecutable({data:u,list:d}):d.filter(function(t){return!0===e.isExecutable({data:t,list:[]})}).length>0)}});case q.Card:return[ge.SELECTION,ge.ROW_DBCLICK].indexOf(e)>=0?[]:this.todos.filter(function(t){return e===([ge.SELECTION,ge.ROW_DBCLICK].indexOf(t.trigger)>=0?ge.ROW_MENU:t.trigger)}).filter(function(e){switch(e.trigger){case ge.TOOLBAR:return!0===e.isExecutable({data:u,list:d});case ge.SELECTION:return!s&&!0===e.isExecutable({data:null,list:d});default:return!s&&!0===e.isExecutable({data:u,list:[]})}});default:return[]}}},{key:Ne,value:function(e,t){var n=t.strict,r=void 0===n||n,o=t.targetData,i=void 0===o?null:o,a=this[pe.container],l=i||a.executingData;switch(a.panel){case q.Form:switch(e){case ge.TOOLBAR:case ge.SELECTION:return{data:l,list:a.data};default:return{data:l,list:[]}}case q.List:switch(e){case ge.TOOLBAR:return{data:null,list:a.data};case ge.SELECTION:return{data:null,list:r?a.selecteds:a.data};default:return r?{data:l,list:[]}:{data:null,list:a.data}}case q.Card:switch(e){case ge.TOOLBAR:return{data:null,list:a.data};default:return{data:l,list:[l]}}}}},{key:"container",get:function(){return this[pe.container]}},{key:"todos",get:function(){return this[pe.todos]}}]),e}(),Le=function(e){var t=e.concat,n=e.ref,r=e.text,o=e.icon,i=e.overrideParams,a=void 0===i?function(){return{}}:i,l=e.editingMode,s=void 0===l?me.POPUP:l,c=e.executable,u=void 0===c?function(){return!0}:c,d=e.onSuccess,f=void 0===d?function(){}:d,p=e.responseMsg,h=void 0===p?{type:"success",icon:"fa fa-check-square-o",content:"資料已完成新增"}:p;if(me.NONE===s)throw new Error("Todo(Create)'s editing mode must be INLINE / POPUP.");var v=new Ce({trigger:ge.TOOLBAR,concat:t,ref:n,text:r,icon:o,editingMode:s,executable:u,overrideParams:a,responseMsg:h,execute:function(e,t){oe()(e);var n=a(),r=new Ge(t,n instanceof Ge?n.$json:n,{editable:!0,isNew:!0,hidden:me.POPUP===s});t.add(r,{callbackFn:function(){var e=me.INLINE===s&&q.Form===t.panel;(me.POPUP===s||e)&&t.setExecuting({data:r,todo:v,popup:!e},e?function(){t.data.filter(function(e){return e.$uid!==r.$uid&&e.$setHidden(!0)})}:null)}})},onSuccess:function(e,t){var n=t.pager.page,r=t.state.filters.filters,o=void 0===r?[]:r;t.doSearch(o,n),f(e)}});return v},Re=function(e){var t=e.trigger,n=void 0===t?ge.ROW_DBCLICK:t,r=e.concat,o=e.ref,i=e.text,a=e.icon,l=e.overrideParams,s=void 0===l?function(e){return e}:l,c=e.editingMode,u=void 0===c?me.POPUP:c,d=e.executable,f=void 0===d?function(){return!0}:d,p=e.onSuccess,h=void 0===p?function(){}:p,v=e.responseMsg,g=void 0===v?{type:"success",icon:"fa fa-check-square-o",content:"資料已完成修改"}:v;if(ge.SELECTION===n)throw new Error('[BasicTodo.UPDATE] Trigger mustn\'t be "SELECTION".');if(ge.TOOLBAR===n&&me.POPUP===u)throw new Error("[BasicTodo.UPDATE] Trigger(TOOLBAR) means multiple-edit, so can't set editing mode as POPUP.");var m=new Ce({trigger:n,concat:r,ref:o,text:i,icon:a,editingMode:u,responseMsg:g,executable:function(e,t){var r=e.data,o=(e.list,t.data.filter(function(e){return!e.$isNew}));return o.length>0&&0===o.filter(function(e){return!0===e.$editable}).length&&!0===f(ge.TOOLBAR===n?{list:o}:{data:r},t)},execute:function(e,t){var r=e.data,o=void 0===r?null:r,i=e.list,a=void 0===i?[]:i;t.edit(!0,{editData:ge.TOOLBAR===n?a.map(function(e){return s(e)}):[s(o)],callbackFn:function(){ge.TOOLBAR!==n&&t.setExecuting({todo:m,data:o,popup:!0})}})},onSuccess:function(e,t){var n=t.pager.page,r=t.state.filters.filters,o=void 0===r?[]:r;t.doSearch(o,n),h(e)}});return m},Te=function(e){var t=e.trigger,n=e.concat,r=e.ref,o=e.text,i=e.icon,a=e.overrideParams,l=void 0===a?function(e){return e}:a,s=e.executable,c=void 0===s?function(){return!0}:s,u=e.onSuccess,d=void 0===u?function(){}:u,f=e.confirmMsg,p=void 0===f?{type:"info",icon:"fa fa-question-circle",title:"資料即將被刪除",content:"確定刪除所選取之資料 ?"}:f,h=e.responseMsg,v=void 0===h?{type:"success",icon:"fa fa-check-square-o",content:"資料已完成刪除"}:h;if(ge.TOOLBAR===t)throw new Error("[BasicTodo.DELETE] Trigger(TOOLBAR) can't remove data.");var g=new Ce({trigger:t,concat:n,ref:r,text:o,icon:i,confirmMsg:p||void 0,responseMsg:v,executable:function(e){var n=e.list,r=e.data;return A(ge.SELECTION===t?n:r).length>0&&!0===c({list:n,data:r})},execute:function(e,n){var r=e.list,o=e.data;n.setExecuting({todo:g,data:ge.SELECTION===t?r.map(function(e){return l(e)}):l(o)},function(){return n.doCommit()})},onSuccess:function(e,t){t.setExecuting({todo:null,data:null},function(){var n=t.pager.page,r=t.state.filters.filters,o=void 0===r?[]:r;t.doSearch(o,n),d(e)})}});return g},Me=new(function(){function e(){h()(this,e)}return g()(e,[{key:"CREATE",get:function(){return Le}},{key:"UPDATE",get:function(){return Re}},{key:"DELETE",get:function(){return Te}}]),e}()),Pe={container:Symbol("CONTAINER"),dataview:Symbol("DATAVIEW"),viewopts:Symbol("VIEW_OPTIONS"),status:Symbol("STATUS"),values:Symbol("VALUES"),inits:Symbol("INITS"),uid:Symbol("UID"),refresh:Symbol("REFRESH")},De=Pe.container,$e=Pe.dataview,Ae=Pe.viewopts,_e=Pe.uid,Ie=Pe.values,Fe=Pe.inits,ze=Pe.status,je=Pe.refresh,Ge=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{checked:!1,editable:!1,isNew:!1,hidden:!1};h()(this,e),N()(this,De,null),N()(this,$e,null),N()(this,Ae,{}),N()(this,_e,$()),N()(this,Ie,{}),N()(this,Fe,"{}"),N()(this,ze,{checked:!1,editable:!1,isNew:!1});var i=o.checked,a=void 0!==i&&i,l=o.editable,s=void 0!==l&&l,c=o.isNew,u=void 0!==c&&c,d=o.hidden,f=void 0!==d&&d;this[Pe.status]={checked:a,editable:s,isNew:u,hidden:f},this[Pe.inits]=JSON.stringify(r),this[Pe.values]=JSON.parse(this[Pe.inits]),Object.keys(this[Pe.values]).forEach(function(e){return Object.defineProperty(n,e,{get:function(){return this[Pe.values][e]},set:function(t){this[Pe.values][e]=t,this[Pe.viewopts]=this[Pe.container].props.view(this),this[Pe.status].checked=this.$isValid,this[Pe.refresh]()}})}),this[Pe.container]=t,this[Pe.viewopts]=this[Pe.container].props.view(this)}return g()(e,[{key:"$undo",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this[Pe.values]=JSON.parse(this[Pe.inits]),this[Pe.status].editable=!1,this[Pe.status].checked=!1,this[Pe.status].hidden=!1,t&&this[Pe.refresh](function(){return e[Pe.container].forceUpdateRef("allSelection")})}},{key:"$setHidden",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=this.$hidden;return this[Pe.status].hidden=!0===e,n!==this.$hidden&&this[Pe.refresh](t,!0),this.$hidden}},{key:"$setEditable",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=this.$editable,o=this[Pe.container].selecteds.length>0;return this[Pe.status].editable=!0===t&&this.$fieldOpts.filter(function(t){var n=t.props,r=n.name,o=n.children;return A(void 0===o?[]:o).filter(function(t){var n=t.type,o=t.props.editable;return n===V&&o instanceof Function&&!0===o(e[r],e)}).length>0}).length>0,r!==t&&this[Pe.refresh](function(){o&&e[Pe.container].data.forEach(function(e){return e.$setChecked(!1)}),n()},!0),this.$editable}},{key:"$setChecked",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=this.$checked,o=this.$selectionOpts,i=o.visible,a=void 0!==i&&i,l=o.disabled,s=void 0===l||l;return this[Pe.status].checked=a&&!s&&!0===t,r!==this.$checked&&this[Pe.refresh](function(){e[Pe.container].forceUpdateRef("allSelection",n)},!0),this.$checked}},{key:"$getValid",value:function(e){var t=this,n=this.$fieldOpts.filter(function(t){return t.props.name===e}).map(function(n){var r=n.props,o=r.label,i=r.children;return A(void 0===i?[]:i).map(function(n){var r=n.props,i=r.required,a=void 0!==i&&i,l=r.validation,s=void 0===l?function(){return!0}:l;return a&&_(t[e])?"".concat(o," 必須輸入."):s(e,t[e],t)})[0]})[0];return!("string"==typeof n&&n.trim().length>0)||n}},{key:je,value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=A(this[n?Pe.container:Pe.dataview]);0===r.length?t():r.forEach(function(o,i){return o.forceUpdate(i!==r.length-1?null:function(){n?t():e[Pe.container].forceUpdateRef(["tbar","modal"],t)})})}},{key:"$dataview",set:function(e){this[Pe.dataview]=e}},{key:"$dataviewOpts",get:function(){return this[Pe.viewopts]}},{key:"$fieldOpts",get:function(){var e=this.$dataviewOpts.props.children;return void 0===e?[]:e}},{key:"$json",get:function(){return JSON.parse(JSON.stringify(this[Pe.values]))}},{key:"$uid",get:function(){return this[Pe.uid]}},{key:"$editable",get:function(){return this[Pe.status].editable}},{key:"$checked",get:function(){return this[Pe.status].checked}},{key:"$isNew",get:function(){return this[Pe.status].isNew}},{key:"$hidden",get:function(){return this[Pe.status].hidden}},{key:"$isDirty",get:function(){return this[Pe.inits]!==JSON.stringify(this[Pe.values])}},{key:"$isValid",get:function(){var e=this,t=this.$fieldOpts;return t.filter(function(t){var n=t.props.name;return!0===e.$getValid(n)}).length===t.length}},{key:"$selectionOpts",get:function(){var e=this[Pe.container],t=e[e.state.$GroupSymbol],n=e.editings.length>0,r=this[Pe.viewopts].props.selectable,o=void 0===r?function(){return!1}:r;return{checked:this.$checked,disabled:n&&(!this.$editable||!this.$isDirty||!this.$isValid),visible:(n?this.$editable:t.getAllowedTodos(ge.SELECTION,{strict:!1}).length>0)&&!0===(o instanceof Function?o(this):o)}}}]),e}(),Be=U.bdColor,qe=U.bgColor,Ue=U.txColor,He=function(e){function t(){return h()(this,t),y()(this,b()(t).apply(this,arguments))}return S()(t,e),g()(t,[{key:"render",value:function(){var e=this.props,t=e.container,n=e.filtering,r=void 0!==n&&n,i=e.options,l=void 0===i?[]:i,s=e.onSwitchFilter,c=void 0===s?function(){}:s;return L.a.createElement("div",{className:"header locked menu"},L.a.createElement(de,o()({align:"right"},{bdColor:Be,bgColor:qe,txColor:Ue},{display:L.a.createElement("i",{className:"fa fa-bars"})}),[L.a.createElement(le,{key:"undo",icon:"fa fa-undo",onClick:function(){return t[tt.onLayoutChange]("Revert")}},"還原設置"),L.a.createElement(ce,{key:"divider-up",color:Ue})].concat(a()(l.filter(function(e){return"string"==typeof e.label}).map(function(e){var n=e.name,i=e.filter,a=void 0===i?null:i,l=e.hideable,s=e.hidden,c=e.label;return L.a.createElement(le,o()({key:n},{icon:s?"fa fa-square-o":"fa fa-check-square",disabled:!l||r&&null!==a,onClick:function(){return t[tt.onLayoutChange]("Hidden",n,{hidden:s})}}),c)})),[this.isFilterable?L.a.createElement(ce,{key:"divider-down",color:Ue}):null,this.isFilterable?L.a.createElement(le,{key:"filter",icon:r?"fa fa-toggle-on":"fa fa-toggle-off",onClick:function(){return c(!r)}},r?"關閉過濾":"開啟過濾"):null])))}},{key:"isFilterable",get:function(){var e=this.props,t=e.container,n=e.options,r=void 0===n?[]:n;return t.pager.total>0&&0===t.editings.length&&r.filter(function(e){var t=e.hidden,n=void 0!==t&&t,r=e.filter;return!n&&null!==(void 0===r?null:r)}).length>0}}]),t}(x.Component),We=function(e){function t(){var e,n;h()(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=y()(this,(e=b()(t)).call.apply(e,[this].concat(o))),N()(w()(n),"state",{filterData:new Ge(n.props.container,N()({},n.props.name,n.initFilterVal))}),N()(w()(n),"onChange",function(){return n.forceUpdate()}),N()(w()(n),"doClear",function(){var e=n.props.name;n.state.filterData[e]="",n.forceUpdate(function(){return n.doFilter()})}),N()(w()(n),"doFilter",function(e){var r=n.props,o=r.container,i=r.name,a=r.filterUID,l=r.filter;e.preventDefault(),e.stopPropagation(),o[t.doFilter](a,{name:i,operator:l,value:n.currFilterVal})}),n}return S()(t,e),g()(t,[{key:"render",value:function(){var e=this,t=this.props.name,n=this.state.filterData;return L.a.createElement("th",{className:"filter-header"},L.a.createElement("form",{onSubmit:this.doFilter,onKeyDown:function(t){return 27===t.keyCode?e.doClear():null}},n.$fieldOpts.filter(function(e){return e.props.name===t}).map(function(r){var i=r.props.children,a=A(void 0===i?[]:i).filter(function(e){return e.type===V});if(0===a.length)throw new Error("Filtering must be set <Editor />.");return a.map(function(r){var i=r.props;return L.a.createElement(V,o()({key:"editor"},s()({},i,{name:t,dataModel:n,editable:!0}),{onChange:e.onChange}))})[0]}),L.a.createElement("a",{className:"kekkai-nav-btn",disabled:_(this.currFilterVal),onClick:_(this.currFilterVal)?null:this.doFilter},L.a.createElement("i",{className:"fa fa-filter"})),L.a.createElement("a",{className:"kekkai-nav-btn",disabled:_(this.currFilterVal),onClick:_(this.currFilterVal)?null:this.doClear},L.a.createElement("i",{className:"fa fa-eraser"}))))}},{key:"initFilterVal",get:function(){var e=this.props,t=e.name,n=e.container.state.filters;return(void 0===n?[]:n).filter(function(e){return e.name===t}).map(function(e){return e.value})[0]||""}},{key:"currFilterVal",get:function(){var e=this.props.name;return this.state.filterData[e]}}]),t}(x.Component);N()(We,"doFilter",Symbol("DO_FILTER"));var Ve=function(e){function t(){var e,n;h()(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=y()(this,(e=b()(t)).call.apply(e,[this].concat(o))),N()(w()(n),"state",{resizing:!1,reordering:!1}),N()(w()(n),"onSorting",function(){if(n.sortable){var e=n.props,t=e.name,r=e.sortStatus,o=void 0===r||r,i=e.onSorting;(void 0===i?function(){}:i)(t,o)}}),N()(w()(n),"onStartResizing",function(e){var t=e.clientX,r=n.props,o=r.name,i=r.onStartResizing,a=void 0===i?function(){}:i;n.setState({resizing:!0},function(){return a(o,t)})}),N()(w()(n),"onStartReordering",function(e){oe()(e);var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=n.props,o=r.name,i=r.seq,a=r.onStartReordering;(void 0===a?function(){}:a)(t,{name:o,seq:i})}),N()(w()(n),"onDragOver",function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=n.props,i=o.name,a=o.reordering,l=void 0!==a&&a;(l||{}).name!==i&&e.preventDefault(),e.target.classList[r?"add":"remove"](t.HoveringClassName)}),N()(w()(n),"onDrop",function(e){oe()(e);var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=n.props,o=r.seq,i=r.reordering,a=void 0!==i&&i,l=r.onReorderingDone,s=void 0===l?function(){}:l,c=a||{},u=c.name,d=c.seq;o>d?s(u,t?o-1:o):o<d&&s(u,t?o:o+1)}),n}return S()(t,e),g()(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.label,r=t.name,o=t.filter,i=t.filtering,a=t.resizable,l=t.reorderable,s=void 0!==l&&l,c=t.reordering,u=void 0!==c&&c,d=(u||{}).name;return L.a.createElement("th",{className:this.className,rowSpan:i&&null===o?2:1},u&&d!==r?L.a.createElement("div",{className:"allowed-reordering"},L.a.createElement("div",{className:"before",onDragOver:function(t){return e.onDragOver(t,!0)},onDragLeave:function(t){return e.onDragOver(t,!1)},onDrop:function(t){return e.onDrop(t,!0)}}),L.a.createElement("div",{className:"behind",onDragOver:function(t){return e.onDragOver(t,!0)},onDragLeave:function(t){return e.onDragOver(t,!1)},onDrop:function(t){return e.onDrop(t,!1)}}),L.a.createElement("span",{onClick:this.onSorting},n)):L.a.createElement("div",{draggable:s,onDragStart:function(t){return e.onStartReordering(t,!0)},onDragEnd:function(t){return e.onStartReordering(t,!1)}},L.a.createElement("span",{onClick:this.onSorting},n),this.menu),"string"==typeof n&&a?L.a.createElement("div",{className:"resizable",onMouseDown:this.onStartResizing}):null)}},{key:"sortable",get:function(){var e=this.props.sortable;return!1!==ne.getSortable({sortable:e})}},{key:"className",get:function(){if(this.sortable){var e=["sortable"],t=this.props.sortStatus,n=void 0===t||t;return!0!==n&&e.push(n),e.join(" ")}return""}},{key:"menu",get:function(){var e=this.props,t=e.name,n=e.filter,r=e.filtering,i=e.lockable,a=e.locked,l=e.hideable,s=e.onLayoutChange,c=void 0===s?function(){}:s;return i||l?L.a.createElement(de,o()({align:"right"},{bdColor:Be,bgColor:qe,txColor:Ue},{display:L.a.createElement("i",{className:"fa fa-angle-down"})}),i?L.a.createElement(le,{key:"locked",icon:a?"fa fa-unlock-alt":"fa fa-lock",onClick:function(){return c("Locked",t,{locked:a})}},a?"解鎖":"鎖定"):null,l?L.a.createElement(le,{key:"hidden",icon:"fa fa-eye-slash",disabled:r&&null!==n,onClick:function(){return c("Hidden",t,{hidden:!1})}},"隱藏"):null):null}}]),t}(x.Component);function Ke(e){var t=e.checked,n=void 0!==t&&t,r=e.indeterminate,o=void 0!==r&&r,i=["fa"];return n?i.push("fa-check-square"):o?i.push("fa-minus-square"):i.push("fa-square-o"),i.join(" ")}function Je(e){var t=e.color,n=void 0===t?"#007bff":t,r=e.visible,o=void 0===r||r,i=e.disabled,a=void 0!==i&&i,l=e.checked,s=void 0!==l&&l,c=e.indeterminate,u=void 0!==c&&c,d=e.onChange,f=void 0===d?function(){}:d;return o?L.a.createElement("button",{type:"button",className:"kekkai-checkbox-selection",disabled:a,onClick:function(){return f(u?s:!s)}},L.a.createElement("i",{className:Ke(e),style:{color:s||u?n:"#6c757d"}})):null}N()(Ve,"HoveringClassName","hovering");var Ye=function(e){function t(){return h()(this,t),y()(this,b()(t).apply(this,arguments))}return S()(t,e),g()(t,[{key:"render",value:function(){var e=this.props,t=e.container,n=e.rowSpan,r=void 0===n?1:n,o=t.data,i=void 0===o?[]:o,a=t.selecteds,l=void 0===a?[]:a,s=l.length>0&&l.length===i.length;return L.a.createElement("th",{className:"row-selection",rowSpan:r},L.a.createElement(Je,{color:t.bgColor,checked:s,visible:0===t.editings.length,indeterminate:!s&&l.length>0,onChange:function(e){return i.forEach(function(t){return t.$setChecked(e)})}}))}}]),t}(x.Component);n(23);function Xe(e){var t=e.locked,n=void 0!==t&&t,r=e.selectable,o=void 0!==r&&r,i=e.menus,a=void 0===i?[]:i,l=e.columns,s=void 0===l?[]:l,c=n?(o?tt.toolWidth:0)+(0===a.length?0:tt.toolWidth):0;return s.forEach(function(e){var t=e.width,n=void 0===t?D:t;return c+=!1===n?0:"number"!=typeof n||isNaN(n)?function(){throw new Error('Must set a Number or false to <KekkaiField list="...">.')}():n}),c}function Ze(e){var t=e.locked,n=void 0!==t&&t,r=e.selectable,o=void 0!==r&&r,i=e.menus,a=void 0===i?[]:i,l=e.columns,s=void 0===l?[]:l;return L.a.createElement("colgroup",null,n&&o?L.a.createElement("col",{style:{width:tt.toolWidth}}):null,n&&0!==a.length?L.a.createElement("col",{style:{width:tt.toolWidth}}):null,s.map(function(e){var t=e.name,n=e.width,r=void 0===n?D:n;return!1===r?null:L.a.createElement("col",{key:t,style:{width:"number"!=typeof r||isNaN(r)?D:r}})}))}function Qe(e){var t=e.locked,n=void 0!==t&&t,r=e.selectable,o=void 0!==r&&r,i=e.menus,a=void 0===i?[]:i,l=e.children,s=void 0===l?[]:l,c=e.columns,u=void 0===c?[]:c;return L.a.createElement("table",{style:{width:Xe({locked:n,selectable:o,menus:a,columns:u})}},L.a.createElement(Ze,{locked:n,selectable:o,menus:a,columns:u}),L.a.createElement("tbody",null,s))}var et=function(e){function t(){var e,n;h()(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=y()(this,(e=b()(t)).call.apply(e,[this].concat(o))),N()(w()(n),"state",{reordering:!1,resizing:!1,resizeOpts:null}),N()(w()(n),"onStartReordering",function(e,t){var r=t.name,o=t.seq;return n.setState({reordering:!!e&&{name:r,seq:o}})}),N()(w()(n),"onReorderingDone",function(e,t){n.props.container[tt.onLayoutChange]("Reorder",e,{seq:t})}),N()(w()(n),"onStartResizing",function(e,r){n.setState({resizeOpts:{name:e,x:r,distance:0}},function(){t.Body.addEventListener("mouseover",n.onResizing),t.Body.addEventListener("mouseup",n.onCancelResizing),t.Body.addEventListener("mouseleave",n.onCancelResizing)})}),N()(w()(n),"onCancelResizing",function(){var e=n.props,r=e.container,o=e.columns,i=void 0===o?[]:o,a=n.state.resizeOpts,l=a.name,s=a.distance;n.isResizing&&n.setState({resizeOpts:null},function(){t.Body.removeEventListener("mouseover",n.onResizing),t.Body.removeEventListener("mouseup",n.onCancelResizing),t.Body.removeEventListener("mouseleave",n.onCancelResizing),r[tt.onLayoutChange]("Resize",l,{width:i.filter(function(e){return e.name===l}).map(function(e){return e.width+s})[0]})})}),N()(w()(n),"onResizing",function(e){var t=e.clientX;if(n.isResizing){var r=n.state.resizeOpts,o=r.name,i=r.x;n.setState({resizeOpts:{name:o,x:i,distance:t-i}})}}),n}return S()(t,e),g()(t,[{key:"render",value:function(){var e=this,t=this.defaultGroupProps,n=this.props,r=n.container,i=n.filtering,a=void 0!==i&&i,l=n.sort,c=void 0===l?[]:l,u=n.menus,d=void 0===u?[]:u,f=n.children,p=t.columns,h=void 0===p?[]:p,v=h.filter(function(e){var t=e.hidden,n=void 0!==t&&t,r=e.filter;return!n&&null!==(void 0===r?null:r)});return L.a.createElement("table",{style:{width:Xe(this.defaultGroupProps)}},L.a.createElement(Ze,this.defaultGroupProps),L.a.createElement("thead",null,L.a.createElement("tr",null,f,0===d.length?null:L.a.createElement("th",{rowSpan:a?2:1}," "),h.map(function(t){var n=t.name,r=t.label,i=t.seq,l=t.filter,u=void 0===l?null:l,d=t.sortable,f=t.lockable,p=t.hideable,h=t.resizable,v=t.reorderable;return L.a.createElement(Ve,o()({key:n},s()({},e.defaultHeaderColProps,{filter:u,filtering:a,name:n,label:r,seq:i,lockable:f,hideable:p,resizable:h,reorderable:v,sortable:d,sortStatus:c.filter(function(e){return e.name===n}).map(function(e){return e.dir})[0]||!0})))})),a&&0!==v.length?L.a.createElement("tr",null,v.map(function(e){var t=e.name,n=e.filter,i=e.filterUID;return L.a.createElement(We,o()({key:t},{name:t,filterUID:i,filter:n,container:r}))})):null))}},{key:"isResizing",get:function(){return null!==this.state.resizeOpts}},{key:"resizingName",get:function(){return this.isResizing?this.state.resizeOpts.name:null}},{key:"defaultGroupProps",get:function(){var e=this,t=this.props,n=t.locked,r=void 0!==n&&n,o=t.selectable,i=void 0!==o&&o,a=t.menus,l=void 0===a?[]:a,s=t.columns,c=void 0===s?[]:s;return{locked:r,selectable:i,menus:l,columns:JSON.parse(JSON.stringify(c)).map(function(t){var n=t.name;if(e.isResizing&&e.resizingName===n){var r=e.state.resizeOpts.distance;t.width+=r}return t})}}},{key:"defaultHeaderColProps",get:function(){var e=this.state.reordering,t=this.props,n=t.container,r=t.onSorting,o=t.locked,i=void 0!==o&&o;return{toolColor:n.bgColor,locked:i,reordering:e,onSorting:r,onStartReordering:this.onStartReordering,onReorderingDone:this.onReorderingDone,onStartResizing:this.onStartResizing,onLayoutChange:n[tt.onLayoutChange]}}}]),t}(x.Component);N()(et,"Body",document.body);var tt=function(e){function t(){var e,n;h()(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=y()(this,(e=b()(t)).call.apply(e,[this].concat(o))),N()(w()(n),"state",{dropdowning:!1,filtering:!1}),N()(w()(n),"onScroll",function(e){var t=e.target,r=t.scrollLeft,o=void 0===r?0:r,i=t.scrollTop,a=void 0===i?0:i;n.refs.unlockedH.scrollLeft=o,n.refs.lockedC.scrollTop=a}),N()(w()(n),"onAllSelectionRender",function(e){n.props.container.refs.allSelection=e}),N()(w()(n),"onDropdownMenu",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return n.setState({dropdowning:e})}),N()(w()(n),"onSwitchFilter",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=n.props.options;n.setState({filtering:e&&t.filter(function(e){var t=e.hidden,n=void 0!==t&&t,r=e.filter;return!n&&null!==(void 0===r?null:r)}).length>0})}),n}return S()(t,e),g()(t,[{key:"getFieldChildren",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return A(e).filter(function(e){var n=e.type,r=e.key,o=e.props.name,i=void 0===o?r:o;return n===ne&&t.filter(function(e){return e.name===i}).length>0}).sort(function(e,n){var r=e.props.name,o=n.props.name,i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.filter(function(e){return e.name===r})[0]||{}).seq,a=void 0===i?0:i,l=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.filter(function(e){return e.name===o})[0]||{}).seq;return a-(void 0===l?0:l)})}},{key:"render",value:function(){var e=this,n=this.props,r=n.container,i=n.manager,a=n.options,l=n.selectable,c=void 0!==l&&l,u=n.children,d=void 0===u?[]:u,f=this.state.dropdowning,p=a.filter(function(e){var t=e.locked;return!e.hidden&&!0===t}),h=a.filter(function(e){var t=e.locked;return!e.hidden&&!0!==t}),v=this.isFiltering,g=i.getAllowedTodos(ge.ROW_MENU,{strict:!1});if(0===h.length)throw new Error("The count of unlocked columns must be at least one.");return L.a.createElement("div",{className:"kekkai-list-panel",style:{borderColor:r.bdColor}},L.a.createElement("div",{className:r.editings.length>0?"editing":""},L.a.createElement("div",{ref:"lockedH",className:"header locked"},L.a.createElement(et,o()({locked:!0,menus:g,columns:p},this.defaultHeaderProps),c?L.a.createElement(Ye,{ref:this.onAllSelectionRender,container:r,rowSpan:v?2:1}):null)),L.a.createElement("div",{ref:"unlockedH",className:"header"},L.a.createElement(et,o()({locked:!1,columns:h},this.defaultHeaderProps))),L.a.createElement(He,o()({container:r,options:a,filtering:v},{onSwitchFilter:this.onSwitchFilter}))),A(d).length>0?null:L.a.createElement("div",{className:"data-not-found"},L.a.createElement("div",{ref:"lockedC",className:"content locked",style:{width:Xe({locked:!0,selectable:c,columns:p})}}),L.a.createElement("div",{ref:"unlockedC",className:"content",onScroll:this.onScroll},L.a.createElement("div",{style:{height:1,width:Xe({locked:!1,selectable:c,columns:h})}}))),0===A(d).length?null:L.a.createElement("div",{className:f?"dropdowning":""},L.a.createElement("div",{ref:"lockedC",className:"content locked"},L.a.createElement(Qe,{locked:!0,menus:g,columns:p,selectable:c},A(d).map(function(t){return L.a.createElement(st,o()({key:t.key,locked:!0,onDropdownMenu:e.onDropdownMenu},s()({},t.props,e.defaultDataviewProps,{panel:q.List,ref:"locked-".concat(t.props.dataModel.$uid)})),e.getFieldChildren(t.props.children,p).map(function(e){return L.a.createElement(ne,o()({key:e.props.name||e.key},e.props,{locked:!0}))}))}))),L.a.createElement("div",{ref:"unlockedC",className:"content",onScroll:this.onScroll},L.a.createElement(Qe,{locked:!1,columns:h},A(d).map(function(n){return L.a.createElement(st,o()({key:n.key,locked:!1},s()({},n.props,e.defaultDataviewProps,N()({panel:q.List},t.onGetLockedRow,function(){return e.refs["locked-".concat(n.props.dataModel.$uid)]}))),e.getFieldChildren(n.props.children,h).map(function(e){return L.a.createElement(ne,o()({key:e.props.name||e.key},e.props,{locked:!1}))}))})))))}},{key:"isFiltering",get:function(){var e=this.props.container,t=this.state.filtering;return 0===e.editings.length&&t}},{key:"defaultHeaderProps",get:function(){var e=this.props,t=e.container,n=e.onSorting,r=e.selectable,o=void 0!==r&&r,i=e.sort,a=void 0===i?[]:i;return{container:t,filtering:this.isFiltering,selectable:o,sort:a,onSorting:n}}},{key:"defaultDataviewProps",get:function(){var e=this.props;return{owner:e.owner,container:e.container,manager:e.manager}}}]),t}(x.Component);N()(tt,"onLayoutChange",Symbol("ON_LAYOUT_CHANGE")),N()(tt,"onGetLockedRow",$()),N()(tt,"defaultColumnWidth",120),N()(tt,"toolWidth",48);var nt={getListRowClassName:Symbol("GET_LIST_ROW_CLASS_NAME"),getCardRowClassName:Symbol("GET_CARD_ROW_CLASS_NAME"),onRelaction:Symbol("ON_RELACTION"),onListRowRender:Symbol("ON_LIST_ROW_RENDER"),onSelected:Symbol("ON_SELECTED")},rt=nt.getListRowClassName,ot=nt.getCardRowClassName,it=nt.onListRowRender,at=nt.onRelaction,lt=nt.onSelected,st=function(e){function t(e){var n;return h()(this,t),n=y()(this,b()(t).call(this,e)),N()(w()(n),it,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=(0,n.props[tt.onGetLockedRow])();if(t&&null!==e){var r=t.refs.listrow;e.style.height="".concat(Math.max(e.clientHeight,r.clientHeight,38),"px"),r.style.height=e.style.height,function(e,t){[{name:"mousedown",fn:G,value:!0},{name:"mouseup",fn:G,value:!1},{name:"mouseover",fn:B,value:!0},{name:"mouseleave",fn:[B,G],value:!1},{name:"mouseout",fn:[B,G],value:!1}].forEach(function(n){var r=n.name,o=n.fn,i=n.value;e.addEventListener(r,function(n){return A(o).forEach(function(r){return r(i,e,t,n)})}),t.addEventListener(r,function(n){return A(o).forEach(function(r){return r(i,e,t,n)})})})}(r,e),n[nt.onRelaction](n.props)}}),N()(w()(n),lt,function(e){var t=n.props,r=t.dataModel,o=t.onSelected,i=void 0===o?function(){}:o;r.$setChecked(e,function(){return i(r.$checked,r)})}),n[nt.onRelaction](e),n}return S()(t,e),g()(t,[{key:"componentWillReceiveProps",value:function(e){this[nt.onRelaction](e)}},{key:at,value:function(e){var t=e.dataModel,n=e.locked,r=void 0===n?this.props.container:n,o=e[tt.onGetLockedRow],i=void 0===o?this.props[tt.onGetLockedRow]:o;if(q.List!==this.panel&&i)throw new Error("Only panel(list) could set event(onGetLockedRow).");if(!t)throw new Error("<KekkaiDataview /> must be binding props(dataModel).");q.List!==this.panel||r?q.List!==this.panel&&(t.$dataview=this):t.$dataview=[i(),this]}},{key:"render",value:function(){var e=this,t=this.props,n=t.owner,r=t.container,i=t.manager,a=t.dataModel,l=t.locked,c=void 0!==l&&l,u=t.onDropdownMenu,d=void 0===u?function(){}:u,f=r.bdColor,p=r.bgColor,h=(r.txColor,i.getAllowedTodos(ge.ROW_DBCLICK,{targetData:a})),v=c||q.Card===this.panel?i.getAllowedTodos(ge.ROW_MENU,{targetData:a}):[];switch(this.panel){case q.Form:return L.a.createElement("div",{className:"kekkai-dataview row"},this.fields.map(function(t,i){return L.a.createElement(ne,o()({key:t.props.name||t.key},s()({},t.props,{dataModel:a,owner:n,container:r,dataview:e,sortable:ne.getSortable(t.props,{seq:i})})))}));case q.Card:return L.a.createElement("div",{className:this[nt.getCardRowClassName]},L.a.createElement("div",{className:"card container",style:{borderColor:f}},0===v.length?null:L.a.createElement("div",{className:"card-header"},L.a.createElement(de,o()({},U,{align:"right",onOpen:function(){return d(!0)},onClose:function(){return d(!1)},display:L.a.createElement("i",{className:"fa fa-bars"})}),v.map(function(e){return L.a.createElement(le,{key:e.uuid,icon:e.icon,onClick:function(){return e.execute(ge.SELECTION===e.trigger?{list:[a]}:{data:a})}},e.text)}))),L.a.createElement("div",{className:"card-body row"},this.fields.map(function(t,i){return L.a.createElement(ne,o()({key:t.props.name||t.key},s()({},t.props,{dataModel:a,owner:n,container:r,dataview:e,sortable:ne.getSortable(t.props,{seq:i})})))}))));case q.List:return L.a.createElement("tr",{className:A([this[nt.getListRowClassName],0===h.length?"":"row-pointer"]).join(" "),ref:c?"listrow":this[nt.onListRowRender],onDoubleClick:0===h.length?null:function(){return h[0].execute({data:a})}},c&&r.allselectable?L.a.createElement("td",{className:"row-selection"},L.a.createElement(Je,s()({},a.$selectionOpts,{color:p,onChange:this[nt.onSelected]}))):null,0===v.length?null:L.a.createElement("td",{className:"row-menu"},L.a.createElement(de,o()({},U,{onOpen:function(){return d(!0)},onClose:function(){return d(!1)},display:L.a.createElement("i",{className:"fa fa-bars"})}),v.map(function(e){return L.a.createElement(le,{key:e.uuid,icon:e.icon,onClick:function(){return e.execute({data:a})}},e.text)}))),this.fields.map(function(t,i){return L.a.createElement(ne,o()({key:t.props.name||t.key},s()({},t.props,{dataModel:a,owner:n,container:r,dataview:e,sortable:ne.getSortable(t.props,{seq:i})})))}))}}},{key:"panel",get:function(){return this.props.panel||q.List}},{key:"labelSize",get:function(){return this.props.labelSize||t.defaultLabelSize}},{key:"$owner",get:function(){return this.props.owner}},{key:"$container",get:function(){return this.props.container}},{key:"fields",get:function(){return A(this.props.children).filter(function(e){return e.type===ne})}},{key:rt,get:function(){var e=["kekkai-dataview"];return this.props.dataModel.$isValid||e.push("invalid-row"),e.join(" ")}},{key:ot,get:function(){var e=this.props,t=e.dataModel,n=["kekkai-dataview","container",I(e.viewSize)];return t.$isValid||n.push("invalid-row"),n.join(" ")}}]),t}(x.Component);N()(st,"defaultLabelSize",null);n(24);var ct=function(e){function t(){return h()(this,t),y()(this,b()(t).apply(this,arguments))}return S()(t,e),g()(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.container,r=t.children,i=void 0===r?[]:r;return L.a.createElement("div",{className:"kekkai-form-panel container",style:{borderColor:n.bdColor}},A(i).length>0?null:L.a.createElement("div",{className:"data-not-found"}),A(i).map(function(t){return L.a.createElement(st,o()({key:t.key,panel:q.Form},s()({},t.props,e.defaultDataviewProps)))}))}},{key:"defaultDataviewProps",get:function(){var e=this.props,t=e.container;return{owner:e.owner,container:t,manager:e.manager}}}]),t}(x.Component),ut=(n(25),function(e){function t(){var e,n;h()(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=y()(this,(e=b()(t)).call.apply(e,[this].concat(o))),N()(w()(n),"state",{dropdowning:!1}),N()(w()(n),"onDropdownMenu",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return n.setState({dropdowning:e})}),n}return S()(t,e),g()(t,[{key:"render",value:function(){var e=this,t=this.props.children,n=void 0===t?[]:t;return L.a.createElement("div",{className:"kekkai-card-panel"},L.a.createElement("div",null,A(n).length>0?null:L.a.createElement("div",{className:"data-not-found"}),A(n).map(function(t){return L.a.createElement(st,o()({key:t.key,panel:q.Card,onDropdownMenu:e.onDropdownMenu},s()({},t.props,e.defaultDataviewProps)))})))}},{key:"defaultDataviewProps",get:function(){var e=this.props,t=e.container;return{owner:e.owner,container:t,manager:e.manager}}}]),t}(x.Component));function dt(e){var t=e.color,n=void 0===t?"primary":t,r=e.icon,o=e.text,i=e.disabled,a=e.onClick,l=void 0===a?function(){}:a,s=i instanceof Function?i:function(){return!0===i};return L.a.createElement("button",{type:"button",className:["kekkai-btn",n].join(" "),disabled:s(),onClick:l},"string"!=typeof r||0===r.trim().length?null:L.a.createElement("i",{className:r}),o)}var ft="kekkai-snack-mask",pt={onTrigger:$()};function ht(e){var t=e.type,n=e.icon,r=e.show,i=void 0!==r&&r,a=e.title,l=e.content,s=e.onClose,c=void 0===s?function(){}:s;return L.a.createElement(mt,o()({type:t,show:i},{vertical:"top",delay:!1,mask:!0,onClose:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return c("confirm",e)}}),L.a.createElement(gt,o()({key:"content"},{icon:n,title:a,content:l},{btns:[{icon:"fa fa-times",color:"secondary",text:"取消",value:!1},{icon:"fa fa-check",color:"primary",text:"確定",value:!0}]})))}function vt(e){var t=e.type,n=e.icon,r=e.show,i=void 0!==r&&r,a=e.title,l=e.content,s=e.onClose,c=void 0===s?function(){}:s;return L.a.createElement(mt,o()({key:"content"},{type:t,show:i},{delay:5e3,onClose:function(){return c("alert")}}),L.a.createElement(gt,{icon:n,title:a,content:l}))}function gt(e){var t=e.icon,n=e.title,r=e.content,i=e.btns,a=void 0===i?[]:i,l=e[pt.onTrigger],s=void 0===l?function(){}:l;return L.a.createElement("div",{className:"snackbar-content"},L.a.createElement("div",{className:"body"},"string"!=typeof t||0===t.trim().length?null:L.a.createElement("strong",null,L.a.createElement("i",{className:t})),L.a.createElement("div",null,"string"!=typeof n||0===n.trim().length?null:L.a.createElement("h4",{className:"snackbar-title"},n),r)),a&&0!==a.length?L.a.createElement("div",{className:"footer"},Array.isArray(a)?a.filter(function(e){return null!==e}).map(function(e){var t=e.icon,n=e.text,r=e.value,i=e.color,a=void 0===i?"primary":i;return L.a.createElement(dt,o()({key:r},{color:a,icon:t,text:n},{onClick:function(){return s(r)}}))}):a):null)}var mt=function(e){function t(){var e,n;h()(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=y()(this,(e=b()(t)).call.apply(e,[this].concat(o))),N()(w()(n),"delayID",null),N()(w()(n),"state",{height:0}),N()(w()(n),"doClose",function(e){var t=n.props.onClose;(void 0===t?function(){}:t)(e)}),N()(w()(n),"onSnackbarRender",function(e){var t=n.props.mask,r=void 0!==t&&t,o=function t(r){var o=r.target;e.contains(o)||(n.doClose(),document.body.classList.remove(ft),document.body.removeEventListener("click",t))};e?n.setState({height:e.clientHeight},function(){n.setDelayClose(),r&&(document.body.classList.add(ft),document.body.addEventListener("click",o))}):r&&(document.body.classList.remove(ft),document.body.removeEventListener("click",o))}),n}return S()(t,e),g()(t,[{key:"setDelayClose",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props).delay,n=void 0===t?5e3:t;clearTimeout(this.delayID),"TIMEOUT"===this.closeMode&&(this.delayID=setTimeout(function(){e.doClose(),clearTimeout(e.delayID)},n))}},{key:"render",value:function(){var e=this,t=this.props,n=t.show,r=void 0!==n&&n,i=t.type,a=void 0===i?"info":i,l=t.vertical,c=void 0===l?"bottom":l,u=t.children,d=void 0===u?[]:u,f=this.state.height;if(["info","success","warning","danger"].indexOf(a)<0)throw new Error('The type of Snackbar must be "info"/"success"/"warning"/"danger".');return r?L.a.createElement("div",{ref:this.onSnackbarRender,className:["kekkai-snackbar",a].join(" "),style:N()({},"top"===c?"marginBottom":"marginTop",-1*f)},A(d).map(function(t){return gt!==t.type?t:L.a.createElement(gt,o()({key:t.key},s()({},t.props,N()({},pt.onTrigger,function(t){return e.doClose(t)}))))})):null}},{key:"closeMode",get:function(){var e=this.props.delay;return!1===(void 0===e?5e3:e)?"TRIGGER":"TIMEOUT"}}]),t}(x.Component);n(26);function yt(e){var t=e.title,n=e.icon,r=e.bgColor,o=e.txColor,i=e.onClose,a=void 0===i?function(){}:i;return L.a.createElement("div",{className:"header",style:{backgroundColor:r,color:o}},L.a.createElement("h4",{className:"title"},"string"!=typeof n||0===n.trim().length?null:L.a.createElement("i",{className:n}),t),L.a.createElement("button",{type:"button",className:"close",onClick:a,style:{color:o}},L.a.createElement("span",null,"×")))}var kt=function(e){function t(){var e,n;h()(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return n=y()(this,(e=b()(t)).call.apply(e,[this].concat(o))),N()(w()(n),"doClose",function(e){var t=n.props.onClose;(void 0===t?function(){}:t)(e)}),N()(w()(n),"onTrigger",function(){var e=f()(u.a.mark(function e(t){var r,o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.props.onTrigger,o=void 0===r?function(){}:r,e.next=3,o(t);case 3:!1!==e.sent&&n.doClose(t);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n}return S()(t,e),g()(t,[{key:"render",value:function(){var e=this,t=this.props.show,n=void 0!==t&&t,r=this.props,i=r.icon,a=r.title,l=r.bgColor,s=r.txColor,c=r.zIndex,u=void 0===c?1e3:c,d=r.closeByMask,f=void 0===d||d,p=r.children,h=void 0===p?[]:p,v=r.btns,g=void 0===v?[]:v,m=r.alert,y=void 0===m?{type:"info",icon:null,title:null,show:!1,content:null,callbackFn:null}:m,k=r.confirm,b=void 0===k?{type:"info",icon:null,title:null,show:!1,content:null,callbackFn:null}:k,E=r.onCloseMessage,w=void 0===E?function(){}:E;return n?L.a.createElement("div",{className:"kekkai-modal",style:{zIndex:u},onClick:function(){return f?e.doClose():null}},L.a.createElement("div",{className:"dialog"},L.a.createElement("div",{className:"content"},"string"!=typeof a||0===a.trim().length?null:L.a.createElement(yt,o()({icon:i,title:a,bgColor:l,txColor:s},{onClose:function(){return e.doClose()}})),L.a.createElement("div",{className:"body"},L.a.createElement(ht,o()({},b,{onClose:w})),h,L.a.createElement(vt,o()({},y,{onClose:w}))),g&&0!==g.length?L.a.createElement("div",{className:"footer"},Array.isArray(g)?g.filter(function(e){return null!==e}).map(function(t){var n=t.icon,r=t.text,i=t.value,a=t.disabled,l=void 0!==a&&a,s=t.color,c=void 0===s?"primary":s;return L.a.createElement(dt,o()({key:i},{color:c,icon:n,text:r,disabled:l},{onClick:function(){return e.onTrigger(i)}}))}):g):null))):null}}]),t}(x.Component),bt={button:Symbol("Button"),concat:Symbol("Concat")},Et=function(e){function t(){return h()(this,t),y()(this,b()(t).apply(this,arguments))}return S()(t,e),g()(t,[{key:"getExecuteParams",value:function(e){var t=this.props.manager.container,n=q.Form===t.panel;switch(e.trigger){case ge.TOOLBAR:return{data:null,list:t.data};case ge.SELECTION:return{data:null,list:n?t.data:t.selecteds};default:return n?{data:t.data[0],list:[]}:{data:null,list:t.data}}}},{key:"render",value:function(){var e=this.props,t=e.bgColor,n=e.txColor,r=e.manager,o=this,i=this.navitems,a=r.container;return i.length>0||a.modifieds.length>0||a.editings.length>0?L.a.createElement(fe,{className:"toolbar",style:{backgroundColor:t,color:n}},L.a.createElement(ue,null,i.map(function(e){var r=e.type,i=e.key,a=e.$todo;return bt.button===r?L.a.createElement(le,{key:a.uuid,icon:a.icon,onClick:function(){return a.execute(o.getExecuteParams(a))}},a.text):L.a.createElement(de,{key:i,tag:"li",bgColor:t,txColor:n,display:L.a.createElement("span",null,i," ",L.a.createElement("i",{className:"fa fa-caret-down"}))},a.map(function(e){return L.a.createElement(le,{key:e.uuid,icon:e.icon,onClick:function(){return e.execute(o.getExecuteParams(e))}},e.text)}))})),L.a.createElement(ue,null,0===a.modifieds.length?null:L.a.createElement(le,{icon:"fa fa-floppy-o",onClick:function(){return r.container.doCommit()}},"儲存"),0===a.editings.length?null:L.a.createElement(le,{icon:"fa fa-undo",onClick:function(){return a.doRollback()}},"取消"))):null}},{key:"navitems",get:function(){var e=this.props.manager,t=e.container,n=q.Form===t.panel,r=t.selecteds.length>0,o=[];return e.getAllowedTodos(r?ge.SELECTION:ge.TOOLBAR,n?{targetData:t.data[0]}:void 0).forEach(function(e){if(null===e.concat)o.push({type:bt.button,$todo:e});else{var t=o.filter(function(t){return bt.concat===t.type&&t.key===e.concat})[0]||null;null===t?o.push({type:bt.concat,key:e.concat,$todo:[e]}):t.$todo.push(e)}}),o.map(function(e){return bt.button===e.type||e.$todo.length>1?e:{type:bt.button,$todo:e.$todo[0]}})}}]),t}(x.Component);function wt(e){var t=e.bgColor,n=e.txColor,r=e.pager,o=e.onRefresh;return L.a.createElement(fe,{className:"pagerbar",style:{backgroundColor:t,color:n}},L.a.createElement(ue,null,L.a.createElement(le,{icon:"fa fa-step-backward",disabled:1===r.page,onClick:function(){return r.toFirst()}}),L.a.createElement(le,{icon:"fa fa-chevron-left",disabled:1===r.page,onClick:function(){return r.toPrev()}}),L.a.createElement(se,{type:"number",className:"pager-input",min:"1",max:r.maxPage,value:r.page,onChange:function(e){var t=e.target;return r.page=parseFloat(t.value)}}),L.a.createElement(le,{icon:"fa fa-chevron-right",disabled:r.page===r.maxPage,onClick:function(){return r.toNext()}}),L.a.createElement(le,{icon:"fa fa-step-forward",disabled:r.page===r.maxPage,onClick:function(){return r.toLast()}}),1===r.pageSize?null:L.a.createElement(de,{tag:"li",bgColor:t,txColor:n,display:100===r.pageSize?"顯示全部資料":"每頁 ".concat(r.pageSize," 筆")},L.a.createElement(le,{key:"all",onClick:function(){return r.pageSize=100}},"顯示全部資料"),L.a.createElement(ce,{key:"divider",color:n}),L.a.createElement(le,{key:"50",onClick:function(){return r.pageSize=50}},"50 筆"),L.a.createElement(le,{key:"25",onClick:function(){return r.pageSize=25}},"25 筆"),L.a.createElement(le,{key:"10",onClick:function(){return r.pageSize=10}},"10 筆"))),L.a.createElement(ue,{align:"right"},L.a.createElement(ae,{className:"index-info"},"顯示 ",r.start,"-",r.end," 筆 / 共 ",r.maxPage," 頁"),0===r.total?null:L.a.createElement(le,{icon:"fa fa-refresh",onClick:o})))}var Ct={options:Symbol("OPTIONS"),status:Symbol("STATUS"),doChange:Symbol("DO_CHANGE")},St=Ct.options,Ot=Ct.status,Nt=Ct.doChange,xt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};h()(this,e),N()(this,St,{}),N()(this,Ot,{total:0,currPage:1}),this[Ct.options]={pageSize:t,onPagerChange:n}}return g()(e,[{key:"toNext",value:function(){this.page=Math.min(this.maxPage,this.page+(this.page*this.pageSize<this.total?1:0))}},{key:"toPrev",value:function(){this.page=Math.max(1,this.page-(this.page>1?1:0))}},{key:"toFirst",value:function(){this.page=1}},{key:"toLast",value:function(){this.page=Math.ceil(this.total/this.pageSize)}},{key:Nt,value:function(e,t,n){t!==n&&this[Ct.options].onPagerChange(e,this)}},{key:"total",get:function(){return this[Ct.status].total},set:function(e){var t=this.total;this[Ct.status].total="number"!=typeof e||isNaN(e)?0:e,this[Ct.doChange]("TOTAL",t,this.total)}},{key:"page",get:function(){return this[Ct.status].currPage},set:function(e){var t=this.page;this[Ct.status].currPage=Math.min(Math.max(1,"number"!=typeof e||isNaN(e)?t:e),this.maxPage),this[Ct.doChange]("PAGE",t,this.page)}},{key:"pageSize",get:function(){return this[Ct.options].pageSize},set:function(e){var t=this.pageSize,n=this.start;this[Ct.options].pageSize="number"!=typeof e||isNaN(e)?t:e,this[Ct.status].currPage=Math.max(1,Math.ceil(n/this.pageSize)),this[Ct.doChange]("PAGE_SIZE",t,this.pageSize)}},{key:"maxPage",get:function(){return Math.max(1,Math.ceil(this.total/this.pageSize))}},{key:"skip",get:function(){return(this.page-1)*this.pageSize}},{key:"start",get:function(){return this.skip+1}},{key:"end",get:function(){return Math.max(1,Math.min(this.skip+this.pageSize,this.total))}},{key:"params",get:function(){return{page:this.page,pageSize:this.pageSize,skip:this.skip,start:this.start}}}]),e}(),Lt=(n(27),n(28),{initData:Symbol("INIT_DATA"),dataviews:Symbol("DATAVIEWS"),modalProps:Symbol("MODAL_PROPS"),isModalOpen:Symbol("IS_MODAL_OPEN"),getContainerClassName:Symbol("GET_CONTAINER_CLASS_NAME"),onPagerChange:Symbol("ON_PAGER_CHANGE"),onSorting:Symbol("ON_SORTING"),onRefresh:Symbol("ON_REFRESH"),onCloseMessage:Symbol("ON_CLOSE_MESSAGE"),onCloseModal:Symbol("ON_MODAL_CLOSE"),onModalTrigger:Symbol("ON_MODAL_TRIGGER")}),Rt=Lt.initData,Tt=Lt.getContainerClassName,Mt=Lt.dataviews,Pt=Lt.isModalOpen,Dt=Lt.modalProps,$t=Lt.onPagerChange,At=Lt.onSorting,_t=Lt.onRefresh,It=Lt.onCloseMessage,Ft=Lt.onCloseModal,zt=Lt.onModalTrigger,jt=tt.onLayoutChange,Gt=We.doFilter,Bt=function(e){function t(e){var n,r,o;h()(this,t),n=y()(this,b()(t).call(this,e)),N()(w()(n),Rt,new Ge(w()(n))),N()(w()(n),"state",{$GroupSymbol:Symbol("GROUP"),$PagerSymbol:Symbol("PAGER"),alert:{type:"info",icon:null,title:null,show:!1,content:null,callbackFn:null},confirm:{type:"info",icon:null,title:null,show:!1,content:null,callbackFn:null},columns:(o=n.props.panel,q.List===o?j(n[Lt.initData]):q.Card===o?z(n[Lt.initData]):[]),isLoading:!1,data:[],filters:[],executing:{todo:null,data:null,popup:!1},sort:(r=n[Lt.initData],r.$fieldOpts.filter(function(e){var t=e.type,n=e.props.sortable;return t===ne&&"boolean"!=typeof(void 0!==n&&n)}).map(function(e){var t=e.props,n=t.name,r=t.sortable,o=e.$sortable,i=void 0===o?ne.getSortable({sortable:r}):o;return{name:n,dir:i.dir.toLowerCase(),seq:i.seq}}).sort(function(e,t){return e.seq-t.seq}).map(function(e){return{name:e.name,dir:e.dir}}))}),N()(w()(n),$t,function(e,t){var r=n.state,o=r.data,i=r.$PagerSymbol;n.setState({data:"PAGE_SIZE"===e&&100===t.pageSize?[]:o,$PagerSymbol:F(w()(n),i)},"TOTAL"===e?null:n[Lt.onRefresh])}),N()(w()(n),At,function(e,t){var r=n.state.sort,o=void 0===r?[]:r;if(!(n.editings.length>0)){if(!0===t)o.push({name:e,dir:"asc"});else switch(t.toLowerCase()){case"asc":o.filter(function(t){return t.name===e}).forEach(function(e){return e.dir="desc"});break;case"desc":o.splice(o.findIndex(function(t){return t.name===e}),1)}n.setState({sort:o},n[Lt.onRefresh])}}),N()(w()(n),_t,f()(u.a.mark(function e(){var t,r,o,i,a,l,s,c,d,p;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props,r=t.loadingMask,o=void 0!==r&&r,i=t.getSearchResponse,a=void 0===i?function(){}:i,l=n.state,s=l.filters,c=void 0===s?[]:s,d=l.sort,p=void 0===d?[]:d,e.next=4,n.setState({isLoading:o},f()(u.a.mark(function e(){var t,r,o,i,l;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a({filters:c.map(function(e){return{name:e.name,operator:e.operator,value:e.value}}),sort:p,page:n.pager.params});case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0={};case 5:t=e.t0,r=t.data,o=void 0===r?[]:r,i=t.total,l=void 0===i?0:i,n.setState({isLoading:!1,data:o.map(function(e){return new Ge(w()(n),e)})},function(){return n.pager.total=l});case 11:case"end":return e.stop()}},e)})));case 4:case"end":return e.stop()}},e)}))),N()(w()(n),It,function(e,t){var r=n.state[e],o=r.type,i=r.icon,a=r.title,l=r.content,s=r.callbackFn;n.setState(N()({},e,{type:o,icon:i,title:a,content:l,show:!1}),function(){return s instanceof Function?s(t):null})}),N()(w()(n),Ft,function(e){var t=n.state.executing,r=t.todo,o=void 0===r?null:r,i=t.data,a=void 0===i?null:i,l=n.state.alert;n.setState({executing:{todo:o,data:a,popup:!1},alert:!0===e?l:{type:"info",icon:null,title:null,show:!1,content:null,callbackFn:null},confirm:{type:"info",icon:null,title:null,show:!1,content:null,callbackFn:null}},!0===e?null:function(){n.doRollback()})}),N()(w()(n),zt,function(){var e=f()(u.a.mark(function e(t){var r,o,i,a;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=w()(n),o=n.state.executing,i=o.todo,a=o.data,e.next=4,new Promise(function(e){r.setExecuting({popup:!1,todo:i,data:a},f()(u.a.mark(function o(){var l;return u.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,!0===t?n.doCommit():n.doRollback();case 2:!1!==(l=o.sent)?e(l):r.setExecuting({popup:!0,todo:i,data:a,keepMsg:!0},function(){e(l)});case 4:case"end":return o.stop()}},o)})))});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),N()(w()(n),jt,function(e,t,r){var o=r.seq,i=r.locked,a=void 0!==i&&i,l=r.hidden,c=void 0!==l&&l,u=r.width,d=void 0===u?0:u,f=n.state.columns,p=void 0===f?[]:f;if("Revert"===e)n.setState({columns:j(n[Lt.initData])});else if("Reorder"===e){var h=p.filter(function(e){return e.name===t}).map(function(e){return e.seq})[0];if(h!==o){for(var v=[].concat(p),g=o>h,m=Math.min(h,o);m<=Math.max(h,o);m++)v[m].seq=m===h?o:g?v[m].seq-1:v[m].seq+1;n.setState({columns:v.sort(function(e,t){return e.seq-t.seq})})}}else n.setState({columns:p.map(function(n){if(n.name===t)switch(e){case"Locked":n.locked=!a;break;case"Hidden":n.hidden=!c;break;case"Resize":n.width=d}return n}).sort(function(e,t){var n=e.locked,r=void 0!==n&&n,o=t.locked;return r===(void 0!==o&&o)?0:!0===r?-1:1}).map(function(e,t){return s()({},e,{seq:t})})})}),N()(w()(n),Gt,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.name,o=t.operator,i=t.value,a=n.state.filters,l=void 0===a?[]:a,s=l.filter(function(t){return t.$uid===e})[0];s?_(i)?l.splice(l.indexOf(s),1):s.value=i:_(i)||l.push({$uid:e,name:r,operator:o,value:i}),n.doSearch(JSON.parse(JSON.stringify(l)))});var i=n.state,a=i.$GroupSymbol,l=i.$PagerSymbol;return n[a]=new xe(w()(n),A(n.props.todos)),n[l]=new xt(n.props.pageSize,function(e,t){return n[Lt.onPagerChange](e,t)}),n}return S()(t,e),g()(t,[{key:"componentWillReceiveProps",value:function(e){var t,n=this;"todos"in e&&this.setState({$GroupSymbol:F(this,this.state.$GroupSymbol)},function(){var t=n.state.$GroupSymbol;n[t]=new xe(n,A(e.todos))}),"panel"in e&&q.Form===e.panel?this.pager.pageSize=1:"pageSize"in e&&(this.pager.pageSize=e.pageSize),"panel"in e&&this.setState({columns:(t=e.panel,q.List===t?j(n[Lt.initData]):q.Card===t?z(n[Lt.initData]):[])})}},{key:"setAlert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.type,r=void 0===n?"info":n,o=t.title,i=void 0===o?"":o,a=t.icon,l=void 0===a?null:a,s=t.callbackFn,c=void 0===s?null:s,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this.setState({alert:{type:r,icon:l,title:i,content:e,callbackFn:c,show:!0}},u)}},{key:"setConfirm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.type,r=void 0===n?"info":n,o=t.title,i=void 0===o?"":o,a=t.icon,l=void 0===a?null:a,s=t.callbackFn,c=void 0===s?function(){}:s,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this.setState({confirm:{type:r,icon:l,title:i,content:e,callbackFn:c,show:!0}},u)}},{key:"setExecuting",value:function(e){var t=e.todo,n=void 0===t?this.executingTodo:t,r=e.data,o=void 0===r?this.executingData:r,i=e.popup,a=void 0!==i&&i,l=e.keepMsg,c=void 0!==l&&l,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.setState(s()({executing:{todo:n,data:o,popup:a}},c?{}:{alert:{type:"info",icon:null,title:null,show:!1,content:null,callbackFn:null},confirm:{type:"info",icon:null,title:null,show:!1,content:null,callbackFn:null}}),u)}},{key:"forceUpdateRef",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=A(e).filter(function(e){return"string"==typeof e&&e.trim().length>0&&e in t.refs});0===r.length?n():r.forEach(function(e,o){return t.refs[e].forceUpdate(o===r.length-1?n:null)})}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.index,r=void 0===n?0:n,o=t.callbackFn,i=void 0===o?function(){}:o,a=this.state.data,l=void 0===a?[]:a;l.splice(r,0,e),this.setState({data:l},i)}},{key:"edit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,n=t.editData,r=void 0===n?null:n,o=t.callbackFn,i=void 0===o?function(){}:o,a=null===r?this.data:A(r);a.filter(function(t,n){return!t.$isNew&&t.$setEditable(e,n<a.length-1?void 0:i)})}},{key:"doRollback",value:function(){var e=f()(u.a.mark(function e(){var t,n,r,o,i,l=arguments;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(l.length>0&&void 0!==l[0])||l[0],n=this.props.loadingMask,void 0!==n&&n,r=this,o=this.data,i=a()(o),0!==this.modifieds.length&&t){e.next=11;break}o.forEach(function(e){return e.$isNew?i.splice(i.indexOf(e),1):e.$undo(!1)}),this.setState({data:i}),e.next=14;break;case 11:return e.next=13,new Promise(function(e){r.setConfirm("確認放棄目前已變更之資料 ?",{type:"warning",title:"請確認",icon:"fa fa-question",callbackFn:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?(o.forEach(function(e){return e.$isNew?i.splice(i.indexOf(e),1):e.$undo(!1)}),r.setState({data:i},function(){return e()})):e(!1)}})});case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"doSearch",value:function(){var e=f()(u.a.mark(function e(){var t,n,r,o,i,a,l=this,s=arguments;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:[],n=s.length>1&&void 0!==s[1]?s[1]:1,r=this.state.filters,o=void 0===r?[]:r,i=this.pager.page,a=void 0===i?1:i,JSON.stringify(t)===JSON.stringify(o)){e.next=8;break}this.setState({filters:t},function(){return l.pager.page=n}),e.next=12;break;case 8:if(this.pager.page=n,this.pager.page!==a){e.next=12;break}return e.next=12,this[Lt.onRefresh]();case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"doCommit",value:function(){var e=f()(u.a.mark(function e(){var n,r,o,i,a,l,s,c,d,p,h,v=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,r=n.loadingMask,o=void 0!==r&&r,i=n.onCommit,a=void 0===i?function(){}:i,l=this.state.executing,s=l.todo,c=void 0===s?null:s,d=l.data,p=void 0===d?null:d,h=null===c,e.next=5,this.setState({isLoading:o},f()(u.a.mark(function e(){var n,r,o,i,l;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a(h?t.CommitAll:c.ref,h?{modifieds:v.modifieds,removes:[]}:{target:p});case 2:n=e.sent,r=n.success,o=void 0!==r&&r,i=n.msg,l=void 0===i?"":i,v.setState({isLoading:!1},function(){h?o?(v.setAlert("已完成資料異動",{type:"success",icon:"fa fa-check-square-o"}),v.doSearch(v.state.filters,v.pager.page)):v.setAlert(l,{type:"danger",icon:"fa fa-exclamation-circle"}):c.onResponse({success:o,msg:l})});case 8:case"end":return e.stop()}},e)})));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t,n,r,i,a,l,c=this,u=this.state,d=u.$GroupSymbol,f=u.sort,p=u.columns,h=this.props.owner,v=this.bgColor,g=this.txColor;return L.a.createElement("div",{ref:"container",className:this[Lt.getContainerClassName]},this[Lt.isModalOpen]?null:L.a.createElement(ht,o()({},this.state.confirm,{onClose:this[Lt.onCloseMessage]})),L.a.createElement(Et,o()({ref:"tbar"},{bgColor:v,txColor:g,manager:this[d]})),L.a.createElement(wt,{bgColor:v,txColor:g,pager:this.pager,onRefresh:this[Lt.onRefresh]}),function(){switch(c.panel){case q.Form:return L.a.createElement(ct,{owner:h,container:c,manager:c[d]},c[Lt.dataviews]);case q.List:return L.a.createElement(tt,o()({onSorting:c[Lt.onSorting]},{owner:h,sort:f,options:p,container:c,manager:c[d],selectable:c.allselectable}),c[Lt.dataviews]);case q.Card:return L.a.createElement(ut,o()({onSorting:c[Lt.onSorting]},{owner:h,sort:f,options:p,container:c,manager:c[d]}),c[Lt.dataviews])}}(),this[Lt.isModalOpen]?null:L.a.createElement(vt,o()({},this.state.alert,{onClose:this[Lt.onCloseMessage]})),(e=this.state.executing,t=e.popup,n=void 0!==t&&t,r=e.todo,i=void 0===r?null:r,a=e.data,l=void 0===a?null:a,null===i||null===l?null:L.a.createElement(kt,o()({ref:"modal",show:n,icon:i.icon,title:i.text},s()({},c[Lt.modalProps],{btns:[{icon:"fa fa-undo",color:"secondary",text:"取消",value:!1},{icon:"fa fa-floppy-o",color:"primary",text:"儲存",value:!0,disabled:function(){return!l.$editable||!l.$isDirty||!l.$isValid}}]})),L.a.createElement(ct,{owner:h,container:c,manager:c[d],selectable:c.allselectable},l.$dataviewOpts))))}},{key:"panel",get:function(){return this.props.panel||q.List}},{key:"bdColor",get:function(){return this.props.bdColor||"#d6d8db"}},{key:"bgColor",get:function(){return this.props.bgColor||"#007bff"}},{key:"txColor",get:function(){return this.props.txColor||"white"}},{key:"pager",get:function(){return this[this.state.$PagerSymbol]}},{key:"data",get:function(){return Array.isArray(this.state.data)?this.state.data:[]}},{key:"allselectable",get:function(){return this.data.filter(function(e){return e.$selectionOpts.visible}).length>0}},{key:"allselecteds",get:function(){return this.data.filter(function(e){return!0===e.$checked})}},{key:"selecteds",get:function(){return this.data.filter(function(e){return!e.$editable&&!0===e.$checked})}},{key:"editings",get:function(){return this.data.filter(function(e){return e.$editable})}},{key:"executingData",get:function(){return this.state.executing.data}},{key:"executingTodo",get:function(){return this.state.executing.todo}},{key:"modifieds",get:function(){return this.editings.filter(function(e){return e.$checked&&e.$isDirty&&e.$isValid})}},{key:Tt,get:function(){var e=this.state.isLoading,t=["kekkai-container"];if(void 0!==e&&e){var n=window.innerHeight||0,r=this.refs.container.clientHeight||0;t.push("kekkai-loading"),t.push(r>n?"sticky":"absolute")}switch(this.panel){case q.Card:t.push("card");break;case q.Form:t.push("form");break;case q.List:t.push("list")}return t.join(" ")}},{key:Mt,get:function(){return this.data.filter(function(e){return!1===e.$hidden&&e.$dataviewOpts&&e.$dataviewOpts.type===st}).map(function(e){return e.$dataviewOpts})}},{key:Pt,get:function(){var e=this.state.executing,t=e.popup,n=void 0!==t&&t,r=e.todo,o=void 0===r?null:r,i=e.data;return n&&null!==o&&null!==(void 0===i?null:i)}},{key:Dt,get:function(){return{closeByMask:!1,alert:this.state.alert,confirm:this.state.confirm,onCloseMessage:this[Lt.onCloseMessage],onTrigger:this[Lt.onModalTrigger],onClose:this[Lt.onCloseModal],bgColor:this.bgColor,txColor:this.txColor}}}]),t}(x.Component);N()(Bt,"CommitAll",Symbol("ALL_COMMIT")),n.d(t,"KekkaiContainer",function(){return Bt}),n.d(t,"KekkaiDataview",function(){return st}),n.d(t,"KekkaiField",function(){return ne}),n.d(t,"KekkaiDisplay",function(){return W}),n.d(t,"KekkaiEditor",function(){return V}),n.d(t,"LayoutOpts",function(){return q}),n.d(t,"TriggerOpts",function(){return ge}),n.d(t,"EditingOpts",function(){return me}),n.d(t,"Todo",function(){return Ce}),n.d(t,"TodoScripts",function(){return Me})}])});